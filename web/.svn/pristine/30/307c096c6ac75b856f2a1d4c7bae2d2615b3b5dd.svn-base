(function(){new Vue({el:"#js-pageBuyBasketball",data:{matchList:[],matchData:null,matchInfoObj:null,totalOrderPrice:0,selectItem:{num:0},buyInfo:{action:CONFIG.ACTION.previewOrder,lotteryTypeId:"1004",issueNo:"",type:0,betDetail:"",multipleNum:1},isDg:!1,cgDetail:"",cgList:[],cgInfo:CONFIG.CG,winList:[{name:"1-5分",value:"h0105"},{name:"6-10分",value:"h0610"},{name:"11-15分",value:"h1115"},{name:"16-20分",value:"h1620"},{name:"21-25分",value:"h2125"},{name:"26+",value:"h2600"}],loseList:[{name:"1-5分",value:"c0105"},{name:"6-10分",value:"c0610"},{name:"11-15分",value:"c1115"},{name:"16-20分",value:"c1620"},{name:"21-25分",value:"c2125"},{name:"26+",value:"c2600"}],isShowMenu:!1},watch:{cgList:function(e){var t=this;t.setCgDetail(),t.countSelectItem(t.matchInfoObj)},isDg:function(e){var t=this;e?t.cgList.push("单场"):t.cgList.splice(t.cgList.indexOf("单场"),1)},"buyInfo.multipleNum":function(e){var t=this;e<0&&(t.buyInfo.multipleNum=1),t.countSelectItem(t.matchInfoObj)}},methods:{showMenu:function(){var e=this;e.isShowMenu=!e.isShowMenu},setCgDetail:function(){for(var e=this,t=[],i=0,n=e.cgList.length;i<n;i++)t.push(e.cgInfo[e.cgList[i]]);e.cgDetail=t.join(",")},setCheckBox:function(e){for(var t=[],i=0,n=e.length;i<n;i++)(function(i){e[i].matchInfo={sf:[],rang:[],score:[],win:[],lose:[]},t.push(e[i])})(i);return t},formatMatchData:function(){for(var e=this,t={},i=0,n=e.matchList.length;i<n;i++)(function(i){var n=e.matchList[i].dtime.split(" ")[0];t[n]={list:[],weekDay:"",time:""}})(i);for(var a in t)if(t.hasOwnProperty(a))for(var r=0,o=e.matchList.length;r<o;r++)(function(i){var n=e.matchList[i].dtime,r=n.split(" ")[0],o=utility.getCurrentTimeInfo(r);a==r&&(t[a].list.push(e.matchList[i]),t[a].weekDay=o.weekDay,t[a].time=r)})(r);e.matchInfoObj=t},geBkBlendMatches:function(){var e=this;utility.geBkBlendMatches({matchDay:"",type:1,callback:function(t){e.matchList=e.setCheckBox(t.data),e.formatMatchData(),utility.setiScroll()}})},showPopupAndSetData:function(e,t){var i=this;i.matchData={key:e,index:t,data:i.matchInfoObj[e].list[t]},app.popup(".popup-setData")},getCheckResult:function(e){for(var t=[],i=0,n=e.length;i<n;i++)t.push(e[i].split(",")[3]);return t.join(",")},reFormatMatch:function(e){for(var t=[],i=0,n=e.length;i<n;i++)t.push(i+1+"|"+e[i]);return t.join("#")},countSelectItem:function(e){var t=this,i=0,n=[];for(var a in e)if(e.hasOwnProperty(a))for(var r=0,o=e[a].list.length;r<o;r++){var c=e[a].list[r],l=c.matchInfo,s=l.sf,u=l.rang,h=l.score,f=l.win,g=l.lose,m=s.length,d=u.length,v=h.length,p=f.length,I=g.length;m+d+v+p+I>0&&(i++,n.push(c.mid+"|"+c.num+"|"+(s.length>0?t.getCheckResult(s):"")+(u.length>0?","+t.getCheckResult(u):"")+(h.length>0?","+t.getCheckResult(h):"")+(f.length>0?","+t.getCheckResult(f):"")+(g.length>0?t.getCheckResult(g):"")))}t.selectItem.num=i,setTimeout(function(){t.isDg=0!=$("body").find(".dg").find(".active").length&&0==$("body").find(".noDg").find(".active").length,t.setCgDetail(),setTimeout(function(){t.buyInfo.betDetail=t.reFormatMatch(n)+(t.cgDetail.length>0?"%"+t.cgDetail:""),t.setOrderInfo()},500)},500)},setOrderInfo:function(){var e=this;if(0==e.isDg){if(e.selectItem.num<=1)return void(e.totalOrderPrice=0)}else if(0==e.cgList.length)return void(e.totalOrderPrice=0);return 0==e.cgList.length?void(e.totalOrderPrice=0):void utility.previewOrder({service:CONFIG.SERVICE.bOrderService,params:e.buyInfo,callback:function(t){utility.setSessionStorage("orderInfo",{buyInfo:e.buyInfo}),utility.setSessionStorage("resultList",t.matchList),e.totalOrderPrice=t.totalOrderPrice}})},generateOrder:function(){var e=this,t=utility.getSessionStorage("orderInfo");if(0==e.isDg){if(e.selectItem.num<=1)return app.showPreloader("请至少选择两场球赛"),void setTimeout(function(){app.hidePreloader(),e.totalOrderPrice=0},1e3)}else if(0==e.cgList.length)return app.showPreloader("必须选择至少一种串关方式"),void setTimeout(function(){app.hidePreloader(),e.totalOrderPrice=0},1e3);return 0==e.cgList.length?(app.showPreloader("必须选择至少一种串关方式"),void setTimeout(function(){app.hidePreloader(),e.totalOrderPrice=0},1e3)):void(t&&utility.generateOrder({service:CONFIG.SERVICE.bOrderService,callback:function(e){mainView.router.loadPage("/app/view/order/pay.html")}}))}},created:function(){var e=this;e.geBkBlendMatches(),utility.setiScroll(),e.$watch("matchInfoObj",function(t,i){e.countSelectItem(t)},{deep:!0}),$("body").find(".js-showMenu").on("click",function(){e.isShowMenu=!e.isShowMenu})}})})();