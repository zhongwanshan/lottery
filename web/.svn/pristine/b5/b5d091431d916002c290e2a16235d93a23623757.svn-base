(function(){new Vue({el:"#js-pageInfo",data:{isAction:!1,tabType:0,userInfo:USERINFO,imageData:USERINFO.headImageUrl||"",paramInfo:{nickName:USERINFO.nickName,action:CONFIG.ACTION.modifyUserNickName},nickName:"",fileImg:"",resultFile:null,cropper:null,canvas:null},methods:{switchTab:function(e){var i=this;i.tabType=e},userLogout:function(){utility.userLogout(function(){window.location.replace(CONFIG.HOST+"/shop/view/user/login.html")})},doNikNameAction:function(){var e=this;if(1!=e.isAction){if(utility.checkLen(e.nickName,0))return void alert("昵称不能为空");if(e.nickName.length>10)return void alert("昵称长度过长");e.paramInfo.nickName=encodeURI(e.nickName),utility.interactWithServer({headerInfo:{appType:"2",userId:USERINFO?USERINFO.userId:"",userToken:USERINFO?USERINFO.userToken:"",actionUrl:utility.formatActionUrl(CONFIG.SERVICE.commonService,CONFIG.ACTION.modifyUserNickName,e.paramInfo)},url:CONFIG.HOST+CONFIG.SERVICE.commonService,dataObj:e.paramInfo,completeCallback:function(i,t){e.isAction=!1},successCallback:function(i){200==i.code?(e.userInfo.nickName=e.nickName,utility.setLocalStorage("userInfo",e.userInfo)):alert(i.message)}})}},previewImg:function(){var e=this,i=document.getElementById("fileEle").files[0];if(e.fileImg="",e.cropper=null,i){var t=new FileReader;t.readAsDataURL(i),t.onload=function(i){e.fileImg=this.result,setTimeout(function(){var i=document.getElementById("js-fileImg");e.cropper=new Cropper(i,{viewMode:3,data:{width:120,height:120},crop:function(i){e.canvas=e.cropper.getCroppedCanvas(),$("body").find("#js-canvas").html(""),$("body").find("#js-canvas")[0].appendChild(e.canvas)}})},500)}}},modifyUserPhoto:function(){var e=this,i="";if(1!=e.isAction){if(0==e.fileImg.length)return void alert("请选择一张图片");i=e.canvas.toDataURL("image/jpg").split("base64,")[1],utility.interactWithServer({headerInfo:{appType:"2",userId:USERINFO?USERINFO.userId:"",userToken:USERINFO?USERINFO.userToken:"",actionUrl:utility.formatActionUrl(CONFIG.SERVICE.commonService,CONFIG.ACTION.modifyUserPhoto,{action:CONFIG.ACTION.modifyUserPhoto})},contentType:"plain/text",url:CONFIG.HOST+CONFIG.SERVICE.commonService+"?action="+CONFIG.ACTION.modifyUserPhoto+"&userToken="+USERINFO.userToken+"&userId="+USERINFO.userId+"&from=1",dataObj:JSON.stringify({imageData:i}),completeCallback:function(i,t){e.isAction=!1},successCallback:function(i){alert(i.message),200==i.code&&(e.userInfo.headImageUrl=i.data.headImageUrl,utility.setLocalStorage("userInfo",e.userInfo),e.fileImg="",e.cropper.destroy(),$("body").find("#js-canvas").html(""))}})}}},created:function(){var e=this;setTimeout(function(){e.userInfo=USERINFO},1e3)}})})();