(function(){new Vue({el:"#js-pageBuyFootball",data:{matchList:[],matchData:null,matchInfoObj:null,totalOrderPrice:0,selectItem:{num:0},buyInfo:{action:CONFIG.ACTION.previewOrder,lotteryTypeId:"1001",issueNo:"",type:0,betDetail:"",multipleNum:1},isDg:!1,cgDetail:"",cgList:[],cgInfo:CONFIG.CG,sfList:[{name:"胜",value:"s"},{name:"平",value:"p"},{name:"负",value:"f"}],rangList:[{name:"胜",value:"rang_s"},{name:"平",value:"rang_p"},{name:"负",value:"rang_f"}],scoreSList:[{name:"1:0",value:"vs10"},{name:"2:0",value:"vs20"},{name:"2:1",value:"vs21"},{name:"3:0",value:"vs30"},{name:"3:1",value:"vs31"},{name:"3:2",value:"vs32"},{name:"4:0",value:"vs40"},{name:"4:1",value:"vs41"},{name:"4:2",value:"vs42"},{name:"5:0",value:"vs50"},{name:"5:1",value:"vs51"},{name:"5:2",value:"vs52"},{name:"胜其它",value:"vsmore_s"}],scorePList:[{name:"0:0",value:"vs00"},{name:"1:1",value:"vs11"},{name:"2:2",value:"vs22"},{name:"3:3",value:"vs33"},{name:"平其它",value:"vsmore_p"}],scoreFList:[{name:"0:1",value:"vs01"},{name:"0:2",value:"vs02"},{name:"1:2",value:"vs12"},{name:"0:3",value:"vs03"},{name:"1:3",value:"vs13"},{name:"2:3",value:"vs23"},{name:"0:4",value:"vs04"},{name:"1:4",value:"vs14"},{name:"2:4",value:"vs24"},{name:"0:5",value:"vs05"},{name:"1:5",value:"vs15"},{name:"2:5",value:"vs25"},{name:"负其它",value:"vsmore_f"}],ballList:[{name:"0球",value:"g0"},{name:"2球",value:"g2"},{name:"3球",value:"g3"},{name:"4球",value:"g4"},{name:"6球",value:"g6"},{name:"7球以上",value:"g7"}],halfList:[{name:"胜/胜",value:"ss"},{name:"胜/平",value:"sp"},{name:"胜/负",value:"sf"},{name:"平/平",value:"pp"},{name:"平/负",value:"pf"},{name:"负/胜",value:"fs"},{name:"负/平",value:"fp"},{name:"负/负",value:"ff"}],isShowMenu:!1,weekList:{w_1:"星期一",w_2:"星期二",w_3:"星期三",w_4:"星期四",w_5:"星期五",w_6:"星期六",w_7:"星期日"}},watch:{cgList:function(e){var t=this;t.setCgDetail(),t.countSelectItem(t.matchInfoObj)},isDg:function(e){var t=this;e?t.cgList.push("单场"):t.cgList.splice(t.cgList.indexOf("单场"),1)},"buyInfo.multipleNum":function(e){var t=this;e<0&&(t.buyInfo.multipleNum=1),t.countSelectItem(t.matchInfoObj)}},methods:{showMenu:function(){var e=this;e.isShowMenu=!e.isShowMenu},setCgDetail:function(){for(var e=this,t=[],a=0,n=e.cgList.length;a<n;a++)t.push(e.cgInfo[e.cgList[a]]);e.cgDetail=t.join(",")},setCheckBox:function(e){for(var t=[],a=0,n=e.length;a<n;a++)(function(a){e[a].matchInfo={sf:[],rang:[],score:[],ball:[],half:[]},t.push(e[a])})(a);return t},formatMatchData:function(){for(var e=this,t={},a=0,n=e.matchList.length;a<n;a++)(function(a){var n=e.matchList[a].dtime.split(" ")[0];t[n]={list:[],weekDay:"",time:""}})(a);for(var i in t)if(t.hasOwnProperty(i))for(var l=0,r=e.matchList.length;l<r;l++)(function(a){var n=e.matchList[a].dtime,l=n.split(" ")[0],r=utility.getCurrentTimeInfo(l);i==l&&(t[i].list.push(e.matchList[a]),t[i].weekDay=r.weekDay,t[i].time=l)})(l);e.matchInfoObj=t},geFbBlendMatches:function(){var e=this;utility.interactWithServer({headerInfo:{userId:USERINFO?USERINFO.userId:"",userToken:USERINFO?USERINFO.userToken:"",actionUrl:utility.formatActionUrl(CONFIG.SERVICE.lotteryService,CONFIG.ACTION.geFbBlendMatches,{action:CONFIG.ACTION.geFbBlendMatches})},url:CONFIG.HOST+CONFIG.SERVICE.lotteryService,dataObj:{action:CONFIG.ACTION.geFbBlendMatches},beforeSendCallback:function(){app.showIndicator()},completeCallback:function(e,t){app.hideIndicator()},successCallback:function(t){200==t.code&&(e.matchList=e.setCheckBox(t.data),e.formatMatchData(),utility.setiScroll())}})},showPopupAndSetData:function(e,t){var a=this;a.matchData={key:e,index:t,data:a.matchInfoObj[e].list[t]},app.popup(".popup-setData")},getCheckResult:function(e){for(var t=[],a=0,n=e.length;a<n;a++)t.push(e[a].split(",")[3]);return t.join(",")},reFormatMatch:function(e){for(var t=[],a=0,n=e.length;a<n;a++)t.push(a+1+"|"+e[a]);return t.join("#")},countSelectItem:function(e){var t=this,a=0,n=[];for(var i in e)if(e.hasOwnProperty(i))for(var l=0,r=e[i].list.length;l<r;l++){var s=e[i].list[l],o=s.matchInfo,u=o.sf,c=o.rang,v=o.score,m=o.ball,h=o.half,f=u.length,g=c.length,d=v.length,p=m.length,I=h.length;f+g+d+p+I>0&&(a++,n.push(s.mid+"|"+s.num+"|"+(f>0?t.getCheckResult(u):"")+(g>0?","+t.getCheckResult(c):"")+(d>0?","+t.getCheckResult(v):"")+(p>0?","+t.getCheckResult(m):"")+(I>0?t.getCheckResult(h):"")))}t.selectItem.num=a,setTimeout(function(){t.isDg=0!=$("body").find(".dg").find(".active").length&&0==$("body").find(".noDg").find(".active").length,t.setCgDetail(),setTimeout(function(){t.buyInfo.betDetail=t.reFormatMatch(n)+(t.cgDetail.length>0?"%"+t.cgDetail:""),t.setOrderInfo()},500)},500)},setOrderInfo:function(){var e=this;if(0==e.isDg){if(e.selectItem.num<=1)return void(e.totalOrderPrice=0)}else if(0==e.cgList.length)return void(e.totalOrderPrice=0);return 0==e.cgList.length?void(e.totalOrderPrice=0):void utility.previewOrder({service:CONFIG.SERVICE.bOrderService,params:e.buyInfo,callback:function(t){utility.setSessionStorage("orderInfo",{buyInfo:e.buyInfo}),e.totalOrderPrice=t.totalOrderPrice}})},generateOrder:function(){var e=this,t=utility.getSessionStorage("orderInfo");if(0==e.isDg){if(e.selectItem.num<=1)return app.showPreloader("请至少选择两场球赛"),void setTimeout(function(){app.hidePreloader(),e.totalOrderPrice=0},1e3)}else if(0==e.cgList.length)return app.showPreloader("必须选择至少一种串关方式"),void setTimeout(function(){app.hidePreloader(),e.totalOrderPrice=0},1e3);return 0==e.cgList.length?(app.showPreloader("必须选择至少一种串关方式"),void setTimeout(function(){app.hidePreloader(),e.totalOrderPrice=0},1e3)):void(t&&utility.generateOrder({service:CONFIG.SERVICE.bOrderService,callback:function(e){mainView.router.loadPage("view/order/pay.html")}}))}},created:function(){var e=this;e.geFbBlendMatches(),e.$watch("matchInfoObj",function(t,a){e.countSelectItem(t)},{deep:!0}),$("body").find(".js-showMenu").on("click",function(){e.isShowMenu=!e.isShowMenu})}})})();