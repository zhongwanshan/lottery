(function(){new Vue({el:"#js-pageInfo",data:{userInfo:USERINFO,isAction:!1,imageData:"",paramInfo:{nickName:"",action:CONFIG.ACTION.modifyUserNickName},nickName:"",fileImg:"",resultFile:null,cropper:null,canvas:null},methods:{doNikNameAction:function(){var e=this;if(1!=e.isAction){if(utility.checkLen(e.nickName,0))return app.showPreloader("昵称不能为空"),void setTimeout(function(){app.hidePreloader()},1e3);if(e.nickName.length>10)return app.showPreloader("昵称长度过长"),void setTimeout(function(){app.hidePreloader()},1e3);e.paramInfo.nickName=encodeURIComponent(e.nickName),utility.interactWithServer({headerInfo:{userId:USERINFO?USERINFO.userId:"",userToken:USERINFO?USERINFO.userToken:"",actionUrl:utility.formatActionUrl(CONFIG.SERVICE.commonService,CONFIG.ACTION.modifyUserNickName,e.paramInfo)},url:CONFIG.HOST+CONFIG.SERVICE.commonService,dataObj:e.paramInfo,beforeSendCallback:function(){app.showIndicator()},completeCallback:function(o,a){app.hideIndicator(),e.isAction=!1},successCallback:function(o){200==o.code?(e.userInfo.nickName=e.nickName,utility.setLocalStorage("userInfo",e.userInfo),app.closeModal()):(app.showPreloader(o.message),setTimeout(function(){app.hidePreloader()},1e3))}})}},previewImg:function(){var e=this,o=document.getElementById("fileEle").files[0];if(e.fileImg="",e.cropper=null,o){var a=new FileReader;a.readAsDataURL(o),a.onload=function(o){e.fileImg=this.result,setTimeout(function(){var o=document.getElementById("js-fileImg");e.cropper=new Cropper(o,{viewMode:3,data:{width:120,height:120},crop:function(o){e.canvas=e.cropper.getCroppedCanvas(),$("body").find("#js-canvas").html(""),$("body").find("#js-canvas")[0].appendChild(e.canvas)}})},500)}}},modifyUserPhoto:function(){var e=this,o="";if(1!=e.isAction){if(0==e.fileImg.length)return app.showPreloader("请选择一张图片"),void setTimeout(function(){app.hidePreloader()},1e3);o=e.canvas.toDataURL("image/jpg").split("base64,")[1],utility.interactWithServer({headerInfo:{userId:USERINFO?USERINFO.userId:"",userToken:USERINFO?USERINFO.userToken:"",actionUrl:utility.formatActionUrl(CONFIG.SERVICE.commonService,CONFIG.ACTION.modifyUserPhoto,{action:CONFIG.ACTION.modifyUserPhoto})},contentType:"plain/text",url:CONFIG.HOST+CONFIG.SERVICE.commonService+"?action="+CONFIG.ACTION.modifyUserPhoto+"&userToken="+USERINFO.userToken+"&userId="+USERINFO.userId+"&from=1",dataObj:JSON.stringify({imageData:o}),beforeSendCallback:function(){app.showIndicator()},completeCallback:function(o,a){app.hideIndicator(),e.isAction=!1},successCallback:function(o){200==o.code&&(e.userInfo.headImageUrl=o.data.headImageUrl,utility.setLocalStorage("userInfo",e.userInfo),setTimeout(function(){app.closeModal(".popup-img")},500)),app.showPreloader(o.message),setTimeout(function(){app.hidePreloader()},1e3)}})}}},created:function(){}})})();