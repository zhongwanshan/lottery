(function(){new Vue({el:"#js-pageDeposit",data:{userInfo:USERINFO,isAction:!1,showAddList:!1,allCarList:[],myCarList:[],bindCarInfo:{bankId:"",bankName:"",cardNo:"",bankAccountName:"",subBankName:"",action:CONFIG.ACTION.bindBankCard,payPwd:""},payPwd:"",amount:"",depositInfo:{amount:"",action:CONFIG.ACTION.userWithdrawCash,remark:"",payPwd:"",bindBankCardId:""},depositPwd:"",remark:"",defaultBankId:""},watch:{"bindCarInfo.bankId":function(e){for(var t=this,a=0,i=t.allCarList.length;a<i;a++)if(t.allCarList[a].bankId==e){t.bindCarInfo.bankName=encodeURIComponent(t.allCarList[a].bankName);break}}},methods:{userLogout:function(){utility.userLogout(function(){window.location.replace(CONFIG.HOST+"/shop/view/user/login.html")})},getAllBankList:function(){var e=this;utility.interactWithServer({headerInfo:{appType:"2",userId:USERINFO?USERINFO.userId:"",userToken:USERINFO?USERINFO.userToken:"",actionUrl:""},url:CONFIG.HOST+CONFIG.SERVICE.getBankList,successCallback:function(t){200==t.code&&(e.allCarList=t.data)}})},bindBankCard:function(){var e=this;if(1!=e.isAction){if(utility.checkLen(e.bindCarInfo.bankId,0))return void alert("请选择一张银行卡");if(utility.checkLen(e.bindCarInfo.cardNo,0))return void alert("请输入银行卡号");if(utility.checkLen(e.bindCarInfo.bankAccountName,0))return void alert("请输入开户人");if(utility.checkLen(e.bindCarInfo.subBankName,0))return void alert("请输入开户行");if(utility.checkLen(e.payPwd,0))return void alert("请输入支付密码");e.bindCarInfo.payPwd=md5(e.payPwd).toUpperCase(),utility.interactWithServer({headerInfo:{appType:"2",userId:USERINFO?USERINFO.userId:"",userToken:USERINFO?USERINFO.userToken:"",actionUrl:utility.formatActionUrl(CONFIG.SERVICE.walletService,CONFIG.ACTION.bindBankCard,e.bindCarInfo)},url:CONFIG.HOST+CONFIG.SERVICE.walletService,dataObj:e.bindCarInfo,completeCallback:function(t,a){e.isAction=!1},successCallback:function(t){200==t.code?(e.getUserBindCardList(),e.showAddList=!1):alert(t.message)}})}},isShowAddList:function(e){var t=this;t.showAddList=e},getUserBindCardList:function(){var e=this;utility.interactWithServer({headerInfo:{appType:"2",userId:USERINFO?USERINFO.userId:"",userToken:USERINFO?USERINFO.userToken:"",actionUrl:utility.formatActionUrl(CONFIG.SERVICE.walletService,CONFIG.ACTION.getUserBankCards,{action:CONFIG.ACTION.getUserBankCards})},url:CONFIG.HOST+CONFIG.SERVICE.walletService,dataObj:{action:CONFIG.ACTION.getUserBankCards},successCallback:function(t){if(200==t.code){e.myCarList=t.data;for(var a=0,i=e.myCarList.length;a<i;a++)if(1==e.myCarList[a].isDefault){e.depositInfo.bindBankCardId=e.myCarList[a].bindBankCardId;break}}}})},setDefaultBankCard:function(e){var t=this;utility.interactWithServer({headerInfo:{appType:"2",userId:USERINFO?USERINFO.userId:"",userToken:USERINFO?USERINFO.userToken:"",actionUrl:utility.formatActionUrl(CONFIG.SERVICE.walletService,CONFIG.ACTION.setDefaultBankCard,{action:CONFIG.ACTION.setDefaultBankCard,bindBankCardId:e})},url:CONFIG.HOST+CONFIG.SERVICE.walletService,dataObj:{action:CONFIG.ACTION.setDefaultBankCard,bindBankCardId:e},successCallback:function(e){200==e.code&&t.getUserBindCardList()}})},depositAction:function(){var e=this;if(1!=e.isAction){if(utility.checkLen(e.depositInfo.bindBankCardId,0))return void alert("请选择一张银行卡");if(utility.checkLen(e.amount,0))return void alert("请输入提现金额");if(utility.checkLen(e.depositPwd,0))return void alert("请输入支付密码");e.depositInfo.amount=100*e.amount,e.depositInfo.payPwd=md5(e.depositPwd).toUpperCase(),e.depositInfo.remark=encodeURIComponent(e.remark),utility.interactWithServer({headerInfo:{appType:"2",userId:USERINFO?USERINFO.userId:"",userToken:USERINFO?USERINFO.userToken:"",actionUrl:utility.formatActionUrl(CONFIG.SERVICE.walletService,CONFIG.ACTION.userWithdrawCash,e.depositInfo)},url:CONFIG.HOST+CONFIG.SERVICE.walletService,dataObj:e.depositInfo,completeCallback:function(t,a){e.isAction=!1},successCallback:function(e){200==e.code||alert(e.message)}})}}},created:function(){var e=this;e.getUserBindCardList(),e.getAllBankList(),setTimeout(function(){e.userInfo=USERINFO},1e3)}})})();