(function(){new Vue({el:"#js-message",data:{mescroll:null,userInfo:USERINFO,imageData:USERINFO.headImageUrl||"",messageInfo:{curPage:1,pageSize:5,type:0,readStatus:2,action:CONFIG.ACTION.getUserSiteMessageList},pageCount:1,listInfo:{type_0:[],type_1:[],type_2:[],type_3:[],type_4:[]},typeStr:{0:"全部",1:"优惠信息",2:"中奖通知",3:"活动",4:"其它"},readStatusStr:{0:"未读",1:"已读",2:"全部"},messageList:[]},watch:{"messageInfo.type":function(){var e=this;e.messageInfo.curPage=1,e.messageList=[],e.mescroll.destroy(),e.setMescrollAction()},"messageInfo.readStatus":function(){var e=this;e.messageInfo.curPage=1,e.messageList=[],e.mescroll.destroy(),e.setMescrollAction()}},methods:{getUserSiteMessageList:function(){var e=this;utility.getUserSiteMessageList({messageInfo:e.messageInfo,callback:function(s){s.data.length>0&&e.messageInfo.curPage<=Math.ceil(s.count/e.messageInfo.pageSize)&&(e.messageInfo.curPage=e.messageInfo.curPage+1,e.messageList=s.data.concat(e.messageList)),e.mescroll.endBySize(e.messageList.length,s.count),e.mescroll.endSuccess()}})},setMescrollAction:function(){var e=this;e.mescroll=new MeScroll("mescroll",{down:{callback:function(){e.getUserSiteMessageList()}},up:{callback:function(){e.getUserSiteMessageList()}}})},modifySiteMessage:function(e,s){var t=this;utility.interactWithServer({headerInfo:{userId:USERINFO?USERINFO.userId:"",userToken:USERINFO?USERINFO.userToken:"",actionUrl:utility.formatActionUrl(CONFIG.SERVICE.commonService,CONFIG.ACTION.modifySiteMessage,{action:CONFIG.ACTION.modifySiteMessage,msgId:e,state:1})},url:CONFIG.HOST+CONFIG.SERVICE.commonService,dataObj:{action:CONFIG.ACTION.modifySiteMessage,msgId:e,state:1},successCallback:function(e){if(200==e.code){var a=t.messageList[s].contentType;2==a?(t.messageList[s].readStatus=1,setTimeout(function(){mainView.router.loadPage("/app/view/order/detail.html?orderCode="+t.messageList[s].msgUrl.split("=")[1])},1e3)):(t.messageList=[],t.getUserSiteMessageList())}else app.showPreloader(e.message),setTimeout(function(){app.hidePreloader()},1e3)}})}},created:function(){},mounted:function(){var e=this;e.setMescrollAction()}})})();