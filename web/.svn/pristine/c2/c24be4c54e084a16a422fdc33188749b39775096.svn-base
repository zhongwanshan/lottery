var app=new Framework7({pushState:!0,uniqueHistory:!0,pushStateSeparator:"#page/",modalTitle:"消息提示",modalButtonOk:"确认",modalButtonCancel:"关闭",modalPreloaderTitle:"加载中...",onAjaxStart:function(e){app.showIndicator()},onAjaxComplete:function(e){app.hideIndicator()}}),$=Dom7,mainView=app.addView(".view-main",{dynamicNavbar:!0,animatePages:!1}),queryInfo=utility.getQueryParams(),USERINFO=utility.getLocalStorage("userInfo"),pageVue=new Vue({el:"#js-cashier",data:{queryInfo:queryInfo,location:LOCATION,payChannelId:"",amount:"",walletLeftCash:0,payChannelList:[],isAction:!1,userAccount:"",payPwd:"",paramInfo:{action:CONFIG.ACTION.resetUserPayPwd,smsCode:"",payPwd:""},imgSrc:"",imgCode:"",reqId:"",time:null,smsTxt:"获取验证码"},watch:{payChannelId:function(e){for(var a=this,t=0,o=a.payChannelList.length;t<o;t++)if("wallet"==a.payChannelList[t].payChannelId){a.walletLeftCash=a.payChannelList[t].walletLeftCash;break}}},methods:{setPayChannelId:function(e){var a=this;a.payChannelId=e},getPayChannel:function(){var e=this;utility.interactWithServer({headerInfo:{appType:queryInfo.appType,userId:USERINFO?USERINFO.userId:"",userToken:USERINFO?USERINFO.userToken:"",actionUrl:utility.formatActionUrl(CONFIG.SERVICE.walletService,CONFIG.ACTION.getPayChannel,{action:CONFIG.ACTION.getPayChannel,orderCode:queryInfo.orderCode,payFlag:queryInfo.payFlag})},url:CONFIG.HOST+CONFIG.SERVICE.walletService,dataObj:{action:CONFIG.ACTION.getPayChannel,orderCode:queryInfo.orderCode,payFlag:queryInfo.payFlag},beforeSendCallback:function(){app.showIndicator()},completeCallback:function(e,a){app.hideIndicator()},successCallback:function(a){200==a.code?(e.payChannelList=a.data,e.amount=e.payChannelList[0].amount):(app.showPreloader(a.message),setTimeout(function(){app.hidePreloader()},1e3))}})},payAction:function(){var e=this;if(utility.checkLen(e.payChannelId,0))return app.showPreloader("请选择一种支付方式"),void setTimeout(function(){app.hidePreloader()},1e3);if("wallet"==e.payChannelId){if(e.walletLeftCash<queryInfo.amount)return app.showPreloader("钱包余额不足!"),void setTimeout(function(){app.hidePreloader()},1e3);if(0==e.payPwd.length)return app.showPreloader("请输入支付密码"),void setTimeout(function(){app.hidePreloader()},1e3)}window.location.href=CONFIG.HOST+utility.formatActionUrl(CONFIG.SERVICE.walletService,CONFIG.ACTION.getPay,{action:CONFIG.ACTION.getPay,payChannelId:e.payChannelId,orderCode:queryInfo.orderCode,payPwd:md5(e.payPwd).toUpperCase()},!0)+"&userId="+USERINFO.userId+"&userToken="+USERINFO.userToken+"&appType="+queryInfo.appType+"&orderCode="+USERINFO.orderCode},getImgCode:function(){var e=this;utility.getImgCode(function(a){e.reqId=a.data.reqId,e.imgSrc=a.data.imgCodeUrl})},getSmsCode:function(){var e=this;if(1!=e.isAction)return utility.checkLen(e.userAccount,0)?(app.showPreloader("手机号不能为空"),void setTimeout(function(){app.hidePreloader()},1e3)):utility.checkPhone(e.userAccount)?void utility.checkImgCode(e.reqId,e.imgCode,function(){utility.getSmsCode(e.reqId,e.imgCode,e.userAccount,"4",function(){var a=60;e.time=setInterval(function(){a--,e.smsTxt="还有"+a+"秒",0==a&&(e.smsTxt="重新发送",clearInterval(e.time))},1e3)},function(){e.isAction=!1})}):(app.showPreloader("手机号格式错误"),void setTimeout(function(){app.hidePreloader()},1e3))},doAction:function(){var e=this;if(1!=e.isAction){if(utility.checkLen(e.userAccount,0))return app.showPreloader("手机号不能为空"),void setTimeout(function(){app.hidePreloader()},1e3);if(!utility.checkPhone(e.userAccount))return app.showPreloader("手机号格式错误"),void setTimeout(function(){app.hidePreloader()},1e3);if(utility.checkLen(e.paramInfo.smsCode,0))return app.showPreloader("验证码不能为空"),void setTimeout(function(){app.hidePreloader()},1e3);if(e.payPwd.length<6||e.payPwd.length>16)return app.showPreloader("密码为6到16位"),void setTimeout(function(){app.hidePreloader()},1e3);e.paramInfo.payPwd=md5(e.payPwd).toUpperCase(),utility.interactWithServer({headerInfo:{appType:queryInfo.appType,userId:USERINFO?USERINFO.userId:"",userToken:USERINFO?USERINFO.userToken:"",actionUrl:utility.formatActionUrl(CONFIG.SERVICE.commonService,CONFIG.ACTION.resetUserPayPwd,e.paramInfo)},url:CONFIG.HOST+CONFIG.SERVICE.commonService,dataObj:e.paramInfo,beforeSendCallback:function(){app.showIndicator()},completeCallback:function(a,t){app.hideIndicator(),e.isAction=!1},successCallback:function(e){200==e.code?app.closeModal(".popup-about"):(app.showPreloader(e.message),setTimeout(function(){app.hidePreloader()},1e3))}})}}},created:function(){var e=this;e.getPayChannel(),e.getImgCode()}});