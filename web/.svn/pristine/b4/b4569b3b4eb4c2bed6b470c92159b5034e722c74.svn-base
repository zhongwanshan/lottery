(function(){new Vue({el:"#js-pageRegister",data:{isAction:!1,pwd:"",paramInfo:{phone:"",userType:"0",action:CONFIG.ACTION.registerUserByPhone,smsCode:"",pwd:"",nickName:""},nickName:"",imgSrc:"",imgCode:"",reqId:"",time:null,smsTxt:"获取验证码"},methods:{getImgCode:function(){var e=this;utility.getImgCode(function(o){e.reqId=o.data.reqId,e.imgSrc=o.data.imgCodeUrl})},getSmsCode:function(){var e=this;if(1!=e.isAction)return utility.checkLen(e.paramInfo.phone,0)?(app.showPreloader("手机号不能为空"),void setTimeout(function(){app.hidePreloader()},1e3)):utility.checkPhone(e.paramInfo.phone)?void utility.checkImgCode(e.reqId,e.imgCode,function(){utility.getSmsCode(e.reqId,e.imgCode,e.paramInfo.phone,"1",function(){var o=60;e.time=setInterval(function(){o--,e.smsTxt="还有"+o+"秒",0==o&&(e.smsTxt="重新发送",clearInterval(e.time))},1e3)},function(){e.isAction=!1})}):(app.showPreloader("手机号格式错误"),void setTimeout(function(){app.hidePreloader()},1e3))},login:function(){var e=this;utility.setLocalStorage("remember",{phone:e.paramInfo.userAccount,pwd:e.pwd}),utility.interactWithServer({headerInfo:{appType:"1",userId:USERINFO?USERINFO.userId:"",userToken:USERINFO?USERINFO.userToken:"",actionUrl:utility.formatActionUrl(CONFIG.SERVICE.commonService,CONFIG.ACTION.registerUserByPhone,{userType:"0",pwd:e.paramInfo.pwd,action:CONFIG.ACTION.userLogin,userAccount:e.paramInfo.phone})},url:CONFIG.HOST+CONFIG.SERVICE.commonService,dataObj:{userType:"0",pwd:e.paramInfo.pwd,action:CONFIG.ACTION.userLogin,userAccount:e.paramInfo.phone},beforeSendCallback:function(){app.showIndicator()},completeCallback:function(o,t){app.hideIndicator(),e.isAction=!1},successCallback:function(e){200==e.code&&(utility.setLocalStorage("userInfo",e.data),setTimeout(function(){window.location.href=CONFIG.HOST+"/app/app.html"},500))}})},doAction:function(){var e=this;if(1!=e.isAction){if(utility.checkLen(e.paramInfo.phone,0))return app.showPreloader("手机号不能为空"),void setTimeout(function(){app.hidePreloader()},1e3);if(!utility.checkPhone(e.paramInfo.phone))return app.showPreloader("手机号格式错误"),void setTimeout(function(){app.hidePreloader()},1e3);if(utility.checkLen(e.paramInfo.smsCode,0))return app.showPreloader("验证码不能为空"),void setTimeout(function(){app.hidePreloader()},1e3);if(e.pwd.length<6||e.pwd.length>16)return app.showPreloader("密码为6到16位"),void setTimeout(function(){app.hidePreloader()},1e3);e.paramInfo.pwd=md5(e.pwd).toUpperCase(),e.paramInfo.nickName=encodeURI(e.nickName),utility.interactWithServer({headerInfo:{userId:USERINFO?USERINFO.userId:"",userToken:USERINFO?USERINFO.userToken:"",actionUrl:utility.formatActionUrl(CONFIG.SERVICE.commonService,CONFIG.ACTION.registerUserByPhone,e.paramInfo)},url:CONFIG.HOST+CONFIG.SERVICE.commonService,dataObj:e.paramInfo,beforeSendCallback:function(){app.showIndicator()},completeCallback:function(o,t){app.hideIndicator(),e.isAction=!1},successCallback:function(o){200==o.code?e.login():(app.showPreloader(o.message),setTimeout(function(){app.hidePreloader()},1e3))}})}}},created:function(){var e=this;e.getImgCode()}})})();